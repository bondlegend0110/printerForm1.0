(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{74047:function(e,t,i){Promise.resolve().then(i.bind(i,78101))},78101:function(e,t,i){"use strict";i.r(t);var r,n,a=i(57437),l=i(16463),o=i(2265),s=i(97776),d=i(77413),h=i(97501);(r=n||(n={}))[r.FOUR_SIDED_CUBE=0]="FOUR_SIDED_CUBE",r[r.SIX_SIDED_CUBE=1]="SIX_SIDED_CUBE",r[r.CURVED=2]="CURVED";class c{async initializeRenderEnvironment(){this.modelDimensions=await this.loadModel(),this.createLights(350,this.cameraOffsetsFromModelDimensions(this.modelDimensions)),this.configureCamera(this.modelDimensions),this.configureRenderer(null),this.renderer.render(this.scene,this.camera)}appropriateCameraDistance(e){return Math.max(e.height,e.length,e.width)}producePrintable(e,t,i){switch(e){case 0:this.produceCubedPrintable(t,i);return;case 1:this.produceSixPrintable(t,i);return;case 2:this.produceCurvedPrintable(t,i);return;default:throw Error("Invalid projection kind provided: ".concat(e,". Available options are ").concat(Object.keys(n)))}}produceRevolvedPrintable(e,t){let i=this.renderer.domElement.width,r=new h.kH({orientation:"landscape",unit:"mm",format:"a4"}),n=document.createElement("canvas");n.width=this.renderer.domElement.width,n.height=this.renderer.domElement.height;let a=n.getContext("2d");if(null===a)return;let l=0,o=()=>{let d=new Date().getTime();for(;l<i&&new Date().getTime()-d<=10;){let t=this.renderer.domElement.width/i,r=this.renderer.domElement.width/2-t/2,n=this.renderer.domElement.height;this.positionCamera(this.camera,this.modelDimensions,{phi:Math.PI/2,theta:2*Math.PI*l/i,radius:this.appropriateCameraDistance(this.modelDimensions)}),this.scene.background=new s.Color(16777215),this.scene.background.setHex(16777215*Math.random()),this.renderer.render(this.scene,this.camera);let o=this.renderer.domElement.getContext("webgl2");if(null===o)return;let d=new Uint8Array(t*n*4);o.readPixels(r,0,t,n,o.RGBA,o.UNSIGNED_BYTE,d);let h=new ImageData(t,n);d.forEach((e,t)=>h.data[t]=e),a.putImageData(h,l*t,0),e((l+1)/i),++l}if(l===i){let e=n.toDataURL("image/png");r.addImage(e,"PNG",0,0,297,210),t(r.output("dataurlstring"))}l<i&&setTimeout(o,1)};o(),document.body.appendChild(n)}produceCubedPrintable(e,t){let i=new h.kH({orientation:"landscape",unit:"mm",format:"a4"}),r=Math.floor(1122.5196850527),n=Math.floor(793.700787411),a=document.createElement("canvas");a.width=r,a.height=n;let l=a.getContext("2d");if(null===l)return;let o=0,s=[{theta:0,phi:Math.PI/2},{theta:0,phi:Math.PI},{theta:Math.PI,phi:Math.PI/2},{theta:0,phi:0}],d=new Image;d.src="FOUR_SIDED_BOX.jpg",d.onload=()=>{l.drawImage(d,0,0,r,n);let h=()=>{let d=new Date().getTime();for(;o<4&&new Date().getTime()-d<=10;){let t=this.renderer.domElement.width,i=this.renderer.domElement.height,{theta:a,phi:d}=s[o];this.positionCamera(this.camera,this.modelDimensions,{phi:d,theta:a,radius:this.appropriateCameraDistance(this.modelDimensions)});let h=this.renderer.domElement.getContext("webgl2",{preserveDrawingBuffer:!0,alpha:!0});if(null!==h&&(h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),this.renderer.render(this.scene,this.camera),null===h)return;let c=Math.min(t,i),m=(t-c)/2,u=(i-c)/2,g=new Uint8Array(c*c*4);h.readPixels(m,u,c,c,h.RGBA,h.UNSIGNED_BYTE,g);let p=new ImageData(new Uint8ClampedArray(g),c,c),w=document.createElement("canvas");w.width=c,w.height=c;let x=w.getContext("2d");if(null===x)return;x.putImageData(p,0,0);let f=r/5,b=Math.min(f/c,n/c),D=c*b,j=c*b,v=o%5*f+(f-D)/2,P=(n-j)/2;l.drawImage(w,0,0,c,c,v+f,P,D,j),e((o+1)/4),++o}if(4===o){let e=a.toDataURL("image/png");i.addImage(e,"PNG",0,0,297,210),t(i.output("dataurlstring"))}o<4&&setTimeout(h,1)};h()},d.onerror=e=>{console.error("Error loading template image:",e)}}produceCurvedPrintable(e,t){let i=new Image;i.src="CURVED_FORM_TEMPLATE.jpg",i.onload=()=>{var e=this;let r=i.width,n=i.height,a=document.createElement("canvas");a.width=r,a.height=n;let l=a.getContext("2d");if(null===l)return;l.drawImage(i,0,0,r,n);let o=function(t,a,o,s){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5?arguments[5]:void 0;e.positionCamera(e.camera,e.modelDimensions,{phi:t,theta:0,radius:e.appropriateCameraDistance(e.modelDimensions)});let c=e.renderer.domElement.getContext("webgl2");if(null!==c&&(c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)),e.renderer.render(e.scene,e.camera),c){let e=new Uint8Array(r*n*4);c.readPixels(0,0,r,n,c.RGBA,c.UNSIGNED_BYTE,e);let t=new ImageData(new Uint8ClampedArray(e),r,n),m=document.createElement("canvas");m.width=r,m.height=n;let u=m.getContext("2d");if(null===u)return;u.putImageData(t,0,0),l.save(),a&&(l.translate(r,0),l.scale(-1,1)),o&&(l.translate(0,n),l.scale(1,-1));let g=r*h,p=n/2*h;l.drawImage(m,0,0,r,n/2,(r-g)/2+d,s,g,p),console.log(i.height),console.log(i.width),console.log(n),console.log(r),l.restore()}else console.error("Renderer context is null. Couldn't read pixels.")};o(0,!0,!1,80,65,.9),o(Math.PI,!1,!0,80,65,.9);let s=new h.kH({orientation:"portrait",unit:"px",format:[r,n],putOnlyUsedFonts:!0,floatPrecision:16}),d=a.toDataURL("image/png");s.addImage(d,"PNG",0,0,r,n),t(s.output("dataurlstring"))},i.onerror=e=>{console.error("Error loading image:",e)}}produceSixPrintable(e,t){let i=new h.kH({orientation:"landscape",unit:"mm",format:"a4"}),r=Math.floor(1122.5196850527),n=Math.floor(793.700787411),a=document.createElement("canvas");a.width=r,a.height=n;let l=a.getContext("2d");if(null===l)return;let o=0,s=[{theta:0,phi:Math.PI/2},{theta:0,phi:Math.PI},{theta:Math.PI,phi:Math.PI/2},{theta:0,phi:0},{theta:3*Math.PI/2,phi:Math.PI/2},{theta:Math.PI/2,phi:Math.PI/2}],d=new Image;d.src="SIX_SIDE_TEMPLATE1.jpg",d.onload=()=>{l.drawImage(d,0,0,r,n);let h=()=>{let d=new Date().getTime();for(;o<6&&new Date().getTime()-d<=10;){let t=this.renderer.domElement.width,i=this.renderer.domElement.height,{theta:a,phi:d}=s[o];this.positionCamera(this.camera,this.modelDimensions,{phi:d,theta:a,radius:this.appropriateCameraDistance(this.modelDimensions)});let h=this.renderer.domElement.getContext("webgl2",{preserveDrawingBuffer:!0,alpha:!0});if(null!==h&&(h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT)),this.renderer.render(this.scene,this.camera),null===h)return;let c=Math.min(t,i),m=(t-c)/2,u=(i-c)/2,g=new Uint8Array(c*c*4);h.readPixels(m,u,c,c,h.RGBA,h.UNSIGNED_BYTE,g);let p=new ImageData(new Uint8ClampedArray(g),c,c),w=document.createElement("canvas");w.width=c,w.height=c;let x=w.getContext("2d");if(null===x)return;x.putImageData(p,0,0);let f=r/4,b=n/3,D=Math.min(f/c,b/c),j=c*D,v=c*D,P=0,C=0;o<4?(P=o*f+(f-j)/2,C=b):4==o?(P=3*f+(f-j)/2,C=0):5==o&&(P=3*f+(f-j)/2,C=2*b),l.drawImage(w,0,0,c,c,P,C,j,v),e((o+1)/6),++o}if(6===o){let e=a.toDataURL("image/png");i.addImage(e,"PNG",0,0,297,210),t(i.output("dataurlstring"))}o<6&&setTimeout(h,1)};h()},d.onerror=e=>{console.error("Error loading template image:",e)}}positionCamera(e,t,i){let r=function(e){let t=Math.max(0,e.phi),i=e.theta%(2*Math.PI);return[e.radius*Math.sin(t)*Math.cos(i),e.radius*Math.cos(t),e.radius*Math.sin(t)*Math.sin(i)]}(i);e.position.set(r[0]+0,r[1]+0,r[2]+0),e.lookAt(0,0,0)}configureCamera(e){this.camera.up.applyAxisAngle(new s.Vector3(1,0,0),Math.PI/2),this.positionCamera(this.camera,e,{phi:Math.PI/2,theta:-Math.PI,radius:this.appropriateCameraDistance(e)})}cameraOffsetsFromModelDimensions(e){return[1*e.width/2,1*e.length/2,0]}configureRenderer(e){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setAnimationLoop(e),this.renderer.shadowMap.enabled=!0}createLights(e,t){let[i,r,n]=t;[[-e+i,r,e+n],[i,-e+r,e+n],[i,e+r,n]].map(e=>{let t=new s.DirectionalLight(16777215,2);t.position.set(e[0],e[1],e[2]),this.scene.add(t)}),this.scene.add(new s.AmbientLight),new s.SpotLight().position.set(i,r,e+n),this.scene.add(new s.SpotLight)}async loadModel(){let e=new d.j,t=await e.loadAsync(this.modelInfo.modelUrl),i=new s.MeshStandardMaterial({color:this.modelInfo.modelColor,side:2}),r=new s.Mesh(t,i);return r.castShadow=!0,r.receiveShadow=!0,this.scene.add(r),this.getModelDimensions(r,t)}getModelDimensions(e,t){var i;new s.Box3().setFromObject(e);let{min:r,max:n}=null!==(i=t.boundingBox)&&void 0!==i?i:{min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}};t.computeVertexNormals(),t.computeBoundingSphere();let a={width:n.x-r.x,length:n.y-r.y,height:n.z-r.z};return t.applyMatrix4(new s.Matrix4().makeTranslation(-r.x-a.width/2,-r.y-a.length/2,-r.z-a.height/2)),{...a,boundingRadius:t.boundingSphere.radius}}constructor(e){this.modelInfo=e,this.modelDimensions={width:0,length:0,height:0,boundingRadius:0},this.scene=new s.Scene,this.camera=new s.PerspectiveCamera(75,window.innerWidth/window.innerHeight),this.renderer=new s.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0})}}let m=[{key:0,previewThumbnailImgSrc:"four_side_2.jpg",projectionDescription:"Suits a variety of geometries well",projectionTitle:"Four Sided Cube Projection"},{key:1,previewThumbnailImgSrc:"six_side_2.jpg",projectionDescription:"Suits a variety of geometries well",projectionTitle:"Six Sided Cube Projection"},{key:2,previewThumbnailImgSrc:"curved_2.jpg",projectionDescription:"Front and back of the model printed in a curved form",projectionTitle:"Curved Volume Form"}],u=()=>{let e=(0,l.useSearchParams)(),[t,i]=(0,o.useState)([]),[r,n]=(0,o.useState)({remainingProjections:0,numTotalQueuedProjections:0}),[s,d]=(0,o.useState)(0),h=(0,o.useRef)(null),[u,g]=(0,o.useState)(null),p=(0,o.useRef)(null),[w,x]=(0,o.useState)(!1),[f,b]=(0,o.useState)(!1),D=(0,l.useRouter)(),j=(e,t)=>{let i=t[0];e.producePrintable(i.key,e=>{h.current&&d(100*e)},i=>{u&&URL.revokeObjectURL(u);let r=atob(i.split(",")[1]),a=new Uint8Array(r.length);for(let e=0;e<r.length;e++)a[e]=r.charCodeAt(e);{let e=new Blob([a],{type:"application/pdf"});g(URL.createObjectURL(e)),x(!0)}let l=[...t.slice(1)];n(e=>({...e,remainingProjections:l.length})),d(0),l.length>0&&j(e,l)})},v=async()=>{var r;b(!0),u&&(URL.revokeObjectURL(u),g(null)),x(!1),n({remainingProjections:t.length,numTotalQueuedProjections:t.length}),i([]);let a=e.get("modelUrl");if(null===a)return;let l=new c({modelUrl:a,modelColor:null!==(r=e.get("modelColor"))&&void 0!==r?r:"#dedede"});await l.initializeRenderEnvironment(),j(l,t)},P=s>0;return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsxs)("div",{className:"flex flex-col h-screen w-full ",children:[(0,a.jsxs)("div",{className:"bg-[#1e1e1e] h-full overflow-scroll",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center sticky h-16 top-0 bg-[#1e1e1e]",children:[(0,a.jsx)("div",{className:"px-8 w-full",children:(0,a.jsx)("h1",{className:"font-bold text-3xl text-white",children:"Select Model Projection(s)"})}),(0,a.jsx)("button",{type:"button",className:"bg-[#2c2c2c] px-4 h-full text-white",onClick:()=>{localStorage.setItem("returningToUpload","true"),D.push("/upload")},children:"Return to Editor"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pl-8 pr-8 pb-8",children:m.map(e=>(0,a.jsxs)("div",{className:"rounded-md overflow-hidden ".concat(t.find(t=>t.key===e.key)?"border-blue-600":"border-[#2c2c2c] hover:border-blue-300"," transition duration-200 border-2 h-96"),onClick:()=>{t.find(t=>t.key===e.key)?i(t.filter(t=>t.key!==e.key)):i(t=>[...t,e])},children:[(0,a.jsx)("img",{src:e.previewThumbnailImgSrc,className:"h-52 w-full"}),(0,a.jsxs)("div",{className:"w-full h-full bg-[#222222] p-4 flex flex-col gap-y-2",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:e.projectionTitle}),(0,a.jsx)("p",{style:{color:"#D3D3D3"},children:e.projectionDescription})]})]},e.key))}),(0,a.jsxs)("div",{className:"bg-[#1e1e1e] px-5 py-3 flex flex-row justify-between items-center",children:[(0,a.jsx)("button",{type:"button",className:"bg-gray-500 hover:bg-gray-600 text-white transition duration-200 rounded-md p-5",onClick:()=>D.push("/upload"),children:"Reupload"}),(0,a.jsx)("button",{type:"button",className:"".concat(0===t.length||P?"bg-light-gray-300 text-gray-500 cursor-not-allowed":"bg-light-gray-500 hover:bg-light-gray-300 text-white"," transition duration-200 rounded-md p-5"),onClick:0===t.length||P?void 0:v,style:{backgroundColor:(t.length,"#8E2929")},children:"Next"})]}),w&&(0,a.jsxs)("div",{ref:p,style:{marginTop:"50px"},className:"bg-[#1e1e1e] px-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-4",children:"PDF Preview"}),(0,a.jsx)("iframe",{id:"pdfPreview",src:u||"hi",width:"100%",height:"500px",title:"PDF Preview",style:{border:"1px solid black"}}),(0,a.jsx)("button",{type:"button",className:"transition duration-200 rounded-md p-5 mt-5 bg-light-gray-500 text-white",style:{backgroundColor:"#8E2929"},onClick:()=>{if(!u)return;let e=document.createElement("a");e.href=u,e.download="form.pdf",e.click()},children:"Download Final PDF"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"h-2 w-full ".concat(!P&&"bg-[#1e1e1e]"),children:(0,a.jsx)("div",{className:"relative h-full overflow-hidden bg-[#222222]",children:(0,a.jsx)("div",{id:"progress-bar",ref:h,className:"h-full bg-blue-500 transition-all duration-200",style:{width:"".concat(s,"%")}})})}),(0,a.jsx)("div",{className:"bg-[#2c2c2c] px-5 py-3 flex flex-row justify-between items-center",children:0===r.remainingProjections?(0,a.jsxs)("p",{className:"text-xl",children:[(0,a.jsx)("span",{className:"font-bold transition duration-200 ".concat(0===t.length?"text-red-600":"text-blue-500"),children:t.length})," Projections Selected"]}):(0,a.jsxs)("div",{className:"flex flex-row items-center gap-x-4",children:[(0,a.jsxs)("p",{className:"text-xl",children:["Producing Projection Printable ",r.numTotalQueuedProjections-r.remainingProjections+1,"/",r.numTotalQueuedProjections]}),(0,a.jsx)("p",{children:"|"}),(0,a.jsxs)("p",{className:"font-bold text-2xl text-blue-400",children:[Math.round(s),"%"]})]})})]})]})})};t.default=()=>(0,a.jsx)(o.Suspense,{children:(0,a.jsx)(u,{})})}},function(e){e.O(0,[689,505,842,971,23,744],function(){return e(e.s=74047)}),_N_E=e.O()}]);